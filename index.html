
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Netlify Money ‚Äì O sucesso do investimento</title>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(145deg, #0f172a, #1e293b);
      color: white;
    }
    .container {
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #authContainer {
      width: 90%;
      max-width: 400px;
      background: #1f2937;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 30px #0ea5e9;
    }
    #authContainer h2 { text-align: center; margin-bottom: 20px; color: #0ea5e9; }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 10px;
      background: #0ea5e9;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    #mainDashboard { display: none; }
    header { background: #0f172a; padding: 20px; text-align: center; box-shadow: 0 0 15px #0ea5e9; }
    header h1 { margin: 0; font-size: 2em; color: #22d3ee; }
    header p { margin-top: 5px; font-size: 1.1em; color: #a1a1aa; }

    .barra-saldo {
      background: #1e3a8a; padding: 15px; display: flex;
      justify-content: space-around; align-items: center; color: #fff; font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .dropdown { position: relative; display: inline-block; }
    .dropdown-content {
      display: none; position: absolute; background-color: #1e293b; min-width: 180px; 
      top: 45px; left: 50%; transform: translateX(-50%); z-index: 999; border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }
    .dropdown-content button {
      width: 100%; padding: 10px; text-align: left; background: none;
      border: none; color: white; cursor: pointer; font-size: 0.95em;
    }
    .dropdown-content button:hover { background-color: #0ea5e9; }
    .dropdown:hover .dropdown-content { display: block; }
    .saldo-btn {
      background: #0ea5e9; padding: 10px 20px; border-radius: 30px; font-size: 0.95em;
      box-shadow: 0 0 10px rgba(14,165,233,0.5); color: #fff; font-weight: bold;
      border: none; cursor: pointer;
    }
    nav { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
    nav a {
      padding: 10px 15px; background: #1e293b; border-radius: 10px;
      text-decoration: none; color: #fff; transition: 0.3s;
    }
    nav a:hover { background: #0ea5e9; }
    .pacotes {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px; padding: 30px;
    }
    .pacote {
      background: #1e293b; border-radius: 20px; padding: 20px;
      box-shadow: 0 0 15px rgba(14, 165, 233, 0.2); cursor: pointer; transition: 0.3s;
    }
    .pacote:hover { transform: scale(1.03); box-shadow: 0 0 25px rgba(34, 211, 238, 0.4); }
    .pacote h3 { color: #22d3ee; }
    .pacote p { color: #cbd5e1; }
    footer { text-align: center; padding: 20px; font-size: 0.9em; color: #94a3b8; background: #0f172a; }

    /* Estilo moderno para os modais */
#modalSaque, #modalDeposito {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.modal-content {
  background: #1e293b;
  padding: 25px 20px;
  border-radius: 20px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 0 25px rgba(14,165,233,0.7);
  animation: zoomIn 0.3s ease;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.modal-content h3 {
  margin-top: 0;
  color: #22d3ee;
  text-align: center;
  font-size: 1.5em;
}

.modal-content label {
  font-weight: bold;
  color: #cbd5e1;
  margin-bottom: 5px;
}

.modal-content input,
.modal-content select {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #334155;
  background: #0f172a;
  color: white;
  font-size: 1em;
}

.modal-content button {
  background: #0ea5e9;
  color: white;
  border: none;
  padding: 12px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s ease;
}

.modal-content button:hover {
  background: #22d3ee;
}

.close-btn {
  text-align: center;
  margin-top: 10px;
  color: #94a3b8;
  cursor: pointer;
  font-size: 0.95em;
  transition: color 0.3s;
}
.close-btn:hover { color: #f87171; }

@keyframes zoomIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
    
  </style>
</head>
<body>
  <div class="container">
    <div id="authContainer">
      <h2>Login</h2>
      <button onclick="netlifyIdentity.open()">Entrar</button>
    </div>
  </div>

  <div id="mainDashboard">
    <header>
      <h1>Netlify Money</h1>
      <p>O sucesso do investimento</p>
    </header>
    <div class="barra-saldo">
      <div class="dropdown">
  <span id="userNome" class="user-btn">Bem-vindo, Usu√°rio ‚ñº</span>
  <div class="dropdown-content">
    <button onclick="abrirPerfil()">Ver Perfil</button>
    <button onclick="abrirComissao()">Comiss√£o e Convites</button>
    <button onclick="abrirHistorico()">Hist√≥rico de Transa√ß√µes</button>
    <button onclick="verPacote()">Pacote Comprado</button>
    <button onclick="abrirSuporte()">Suporte</button>
    <button onclick="netlifyIdentity.logout()">Sair</button>
  </div>
</div>
      <div class="dropdown">
        <button class="saldo-btn">Saldo: <span id="saldo">3.00</span> USDT</button>
        <div class="dropdown-content">
          <button onclick="abrirModal()">Sacar</button>
          <button onclick="mostrarDeposito()">Depositar</button>
        </div>
      </div>
      <span onclick="abrirComissao()" style="cursor: pointer; color: white; font-weight: bold;">
        Comiss√£o: <span id="comissao-total">0</span> USDT
      </span>
    </div>

    <nav>
      <a href="#inicio">In√≠cio</a>
      <a href="#pacotes">Pacotes</a>
      <a href="https://t.me/+SbhOh2kpx8c5OWQ0" target="_blank">Grupo Telegram</a>
    </nav>

    <section id="inicio" style="text-align:center; padding: 40px 20px;">
      <h2>Invista com seguran√ßa e receba lucros di√°rios</h2>
      <p style="color: #94a3b8;">Nossa plataforma garante ganhos est√°veis com transpar√™ncia total.</p>
    </section>

    <section id="pacotes" class="pacotes">
      <div class="pacote" onclick="investir(5, 1.5)"><h3>Pacote 1</h3><p>Investimento: 5 USDT</p><p>Lucro: 1.5USDT/dia</p></div>
      <div class="pacote" onclick="investir(10, 2)"><h3>Pacote 2</h3><p>Investimento: 10 USDT</p><p>Lucro: 2USDT/dia</p></div>
      <div class="pacote" onclick="investir(25, 5)"><h3>Pacote 3</h3><p>Investimento: 25 USDT</p><p>Lucro: 5USDT/dia</p></div>
      <div class="pacote" onclick="investir(100, 10)"><h3>Pacote 4</h3><p>Investimento: 100 USDT</p><p>Lucro: 10USDT/dia</p></div>
      <div class="pacote" onclick="investir(200, 20)"><h3>Pacote 5</h3><p>Investimento: 200 USDT</p><p>Lucro: 20USDT/dia</p></div>
      <div class="pacote" onclick="investir(500, 50)"><h3>Pacote 6</h3><p>Investimento: 500 USDT</p><p>Lucro: 50USDT/dia</p></div>
      <div class="pacote" onclick="investir(1000, 100)"><h3>Pacote 7</h3><p>Investimento: 1000 USDT</p><p>Lucro: 100USDT/dia</p></div>
      <div class="pacote" onclick="investir(2000, 200)"><h3>Pacote 8</h3><p>Investimento: 2000 USDT</p><p>Lucro: 200USDT/dia</p></div>
      <div class="pacote" onclick="investir(3000, 300)"><h3>Pacote 9</h3><p>Investimento: 3000 USDT</p><p>Lucro: 300USDT/dia</p></div>
      <div class="pacote" onclick="investir(10000, 1000)"><h3>Pacote 10</h3><p>Investimento: 10000 USDT</p><p>Lucro: 1000USDT/dia</p></div>
    </section>

    <footer>&copy; 2025 Netlify Money ‚Äì Todos os direitos reservados.</footer>
  </div> 
  
<!-- Modal do hist√≥rico com visual 3D -->
<div id="modalHistorico" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:9999; animation:fadeIn 0.4s;">
  <div style="background:#0f172a; padding:25px; border-radius:20px; width:95%; max-width:550px; color:white; box-shadow:0 10px 25px rgba(0,0,0,0.6); transform:scale(1); animation:slideUp 0.4s;">
    <h2 style="text-align:center; margin-bottom:20px;">üìä Hist√≥rico de Transa√ß√µes</h2>
    <div id="listaHistorico" style="display:flex; flex-direction:column; gap:10px; max-height:400px; overflow-y:auto;"></div>
    <button onclick="abrirHistorico()" style="padding:12px 24px; background:#0ea5e9; color:white; border:none; border-radius:12px; font-size:16px; box-shadow:0 4px 12px rgba(0,0,0,0.3);">üìú Ver Hist√≥rico</button>
    <button onclick="fecharHistorico()" style="margin-top:20px; width:100%; padding:12px; background:#1e40af; border:none; color:white; border-radius:10px; font-size:15px; box-shadow:0 4px 12px rgba(0,0,0,0.3);">Fechar</button>
  </div>
</div>

<!-- Anima√ß√µes -->
<style>
@keyframes slideUp {
  from { transform: translateY(50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.card3D {
  background: linear-gradient(145deg, #1e293b, #0f172a);
  border-radius: 15px;
  padding: 15px 20px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.5);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  transform-style: preserve-3d;
}

.card3D:hover {
  transform: rotateX(4deg) rotateY(-4deg) scale(1.02);
  box-shadow: 0 20px 35px rgba(0,0,0,0.6);
}
</style>

  <!-- Painel de Comiss√£o -->
<div id="painelComissao" style="
  display:none;
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.7);
  justify-content:center;
  align-items:center;
  z-index:9999;">
  
  <div style="background:#1e293b;padding:20px;border-radius:15px;width:90%;max-width:400px;color:white;">
    <h3>Comiss√£o e Indica√ß√µes</h3>
    
    <label>Seu link de convite</label>
    <input type="text" id="linkConvite" readonly style="width:100%;padding:10px;margin-bottom:10px;background:#0f172a;color:white;border:none;border-radius:8px;">
    
    <h4>Indica√ß√µes:</h4>
    <ul id="listaIndicados" style="padding-left:20px;"></ul>
    
    <p>Total de Comiss√£o: <span id="comissao-total2">0</span> USDT</p>
    <button onclick="sacarComissao()" style="width:100%;padding:10px;background:#22d3ee;border:none;border-radius:10px;color:white;margin-top:10px;">Sacar Comiss√£o</button>
    <button onclick="fecharComissao()" style="width:100%;padding:10px;background:#0ea5e9;border:none;border-radius:10px;color:white;">Fechar</button>
  </div>
</div>

<!-- Modal Dep√≥sito -->
<div id="modalDeposito">
  <div class="modal-content">
    <h3>Dep√≥sito Manual</h3>

    <div class="form-box">
      <label>Valor para dep√≥sito (USDT)</label>
      <input type="number" id="valorDeposito" placeholder="Ex: 10">
    </div>

    <label for="redeDeposito">Rede</label>
    <select id="redeDeposito" onchange="atualizarEndereco()">
      <option value="BEP20">BEP20 (Binance Smart Chain)</option>
      <option value="TRC20">TRC20 (Tron)</option>
      <option value="APTOS">APTOS (Aptos Network)</option>
    </select>

    <label for="enderecoDeposito">Endere√ßo para dep√≥sito</label>
    <input type="text" id="enderecoDeposito" readonly />

    <label for="comprovativo">Comprovativo (imagem ou PDF)</label>
    <input type="file" id="comprovativo" accept=".jpg,.jpeg,.png,.pdf" />

    <button onclick="solicitarDeposito()">Enviar Dep√≥sito</button>
    <div class="close-btn" onclick="fecharDeposito()">Fechar</div>
  </div>
</div> 

    <script>
    let saldo = 3.00;
let rendimento = 0; // lucro di√°rio total
let proximoPagamento = null; // timestamp da pr√≥xima libera√ß√£o de lucro (em ms)
let indicados = [];
let comissao = 0;
  
// Atualiza saldo na tela
function atualizarSaldo() {
  document.getElementById("saldo").innerText = saldo.toFixed(2);
}

// Fun√ß√£o chamada quando o usu√°rio investe em um pacote
function investir(valor, lucroDiario) {
  if (saldo >= valor) {
    saldo -= valor;
    rendimento += lucroDiario;
    proximoPagamento = Date.now() + 24 * 60 * 60 * 1000;
    atualizarSaldo();
    alert("Investimento de $" + valor + " realizado! Seu pr√≥ximo lucro ser√° creditado em 24h.");

    // ‚úÖ Salvar transa√ß√£o no hist√≥rico
    fetch('/.netlify/functions/salvarTransacao', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: netlifyIdentity.currentUser()?.email,
        tipo: "Investimento",
        valor: valor,
        data: new Date().toISOString()
      })
    });

    // ‚úÖ Envia comiss√£o para o referenciador, se houver
    if (referencia) {
      fetch('/.netlify/functions/adicionarComissao', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          referenciador: referencia,
          valorComissao: valor * 0.10
        })
      }).catch(err => {
        console.error("Erro ao enviar comiss√£o:", err);
      });
    }

    // ‚úÖ Atualiza saldo no backend
    fetch('/.netlify/functions/updateSaldo', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: netlifyIdentity.currentUser()?.email,
        saldo: saldo
      })
    }).catch(err => console.error("Erro ao atualizar saldo:", err));

  } else {
    alert("Saldo insuficiente");
  }
}

// Checa a cada minuto se j√° √© hora de pagar rendimento
setInterval(() => {
  if (proximoPagamento && Date.now() >= proximoPagamento) {
    saldo += rendimento; // adiciona o lucro di√°rio
    proximoPagamento = Date.now() + 24 * 60 * 60 * 1000; // agenda a pr√≥xima
    atualizarSaldo();
    alert("Lucro di√°rio creditado!");
  }
}, 60000); // verifica a cada 1 minuto

    function abrirModal(){document.getElementById('modalSaque').style.display='flex';}
    function fecharModal(){document.getElementById('modalSaque').style.display='none';}
    function mostrarDeposito(){document.getElementById('modalDeposito').style.display='flex';}
    function fecharDeposito(){document.getElementById('modalDeposito').style.display='none';}

    function confirmarSaque() {
  const valor = parseFloat(document.getElementById("valorSaque").value);
  const carteira = document.getElementById("enderecoCarteira").value;
  const rede = document.getElementById("rede").value;

  if (valor < 10) { alert("Saque m√≠nimo √© 10 USDT"); return; }
  if (valor > saldo) { alert("Saldo insuficiente"); return; }

  // Envia solicita√ß√£o de saque para o backend
  fetch('/.netlify/functions/solicitarSaque', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      email: netlifyIdentity.currentUser()?.email,
      valor,
      carteira,
      rede
    })
  })
  .then(res => res.json())
  .then(() => {
    alert("Pedido de saque enviado. Aguarde aprova√ß√£o.");
    fecharModal();
     // Salva transa√ß√£o de saque no hist√≥rico
fetch('/.netlify/functions/salvarTransacao', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: netlifyIdentity.currentUser()?.email,
    tipo: "Saque",
    valor: valor,
    data: new Date().toISOString()
  })
});
  })
  .catch(err => {
    console.error(err);
    alert("Erro ao enviar pedido de saque.");
  });
    }
  
  function abrirPerfil() {
  alert("Seu perfil ainda est√° em desenvolvimento.");
}
    function abrirHistorico() {
  document.getElementById("modalHistorico").style.display = "flex";
  carregarHistorico();
}

function fecharHistorico() {
  document.getElementById("modalHistorico").style.display = "none";
}

function carregarHistorico() {
  const container = document.getElementById("listaHistorico");
  container.innerHTML = "<p style='text-align:center;'>üîÑ Carregando transa√ß√µes...</p>";

  const email = netlifyIdentity.currentUser()?.email;

  fetch("/.netlify/functions/historicoTransacoes", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  })
    .then(res => res.json())
    .then(transacoes => {
      if (!transacoes || transacoes.length === 0) {
        container.innerHTML = "<p style='text-align:center;'>‚ö†Ô∏è Nenhuma transa√ß√£o encontrada.</p>";
        return;
      }

      container.innerHTML = "";
      transacoes.forEach(tx => {
        const div = document.createElement("div");
        div.className = "card3D";
        div.innerHTML = `
          <p><strong>üßæ Tipo:</strong> ${tx.tipo}</p>
          <p><strong>üí∏ Valor:</strong> $${parseFloat(tx.valor).toFixed(2)}</p>
          <p><strong>üìÖ Data:</strong> ${new Date(tx.data).toLocaleString()}</p>
        `;
        container.appendChild(div);
      });
    })
    .catch(err => {
      console.error(err);
      container.innerHTML = "<p style='text-align:center;'>‚ùå Erro ao carregar o hist√≥rico.</p>";
    });
}  
    
function abrirSuporte() {
  window.open("https://t.me/Kormely", "_blank"); // ou link do suporte
}

function verPacote() {
  if (rendimento > 0) {
    alert("Voc√™ comprou um pacote que gera " + rendimento.toFixed(2) + " USDT por dia.");
  } else {
    alert("Voc√™ ainda n√£o comprou nenhum pacote.");
  }
}
  
    function abrirComissao() {
  const painel = document.getElementById("painelComissao");
  painel.style.display = "flex";

  // Pega email do usu√°rio logado no Netlify Identity
  const emailUsuario = netlifyIdentity.currentUser()?.email || "";

  // Gera link de convite din√¢mico
  document.getElementById("linkConvite").value =
    window.location.origin + "?ref=" + encodeURIComponent(emailUsuario);

  // Atualiza lista de indicados
  document.getElementById("listaIndicados").innerHTML =
    indicados.map(i => "<li>" + i + "</li>").join("");

  // Atualiza total de comiss√£o
  document.getElementById("comissao-total2").innerText = comissao.toFixed(2);
      }
    function fecharComissao(){document.getElementById("painelComissao").style.display="none";}

      function sacarComissao() {
  const valor = parseFloat(prompt("Digite o valor que deseja transferir da comiss√£o para o saldo:"));

  if (!valor || isNaN(valor)) {
    alert("Valor inv√°lido.");
    return;
  }

  if (valor < 5) {
    alert("Saque m√≠nimo da comiss√£o √© 5 USDT.");
    return;
  }

  if (valor > comissao) {
    alert("Voc√™ n√£o tem comiss√£o suficiente.");
    return;
  }

  const email = netlifyIdentity.currentUser()?.email;

  fetch('/.netlify/functions/sacarComissao', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, valor })
  })
    .then(res => res.json())
    .then(data => {
      if (data.sucesso) {
        alert("Transferido para seu saldo!");
        comissao = data.novaComissao;
        saldo = data.novoSaldo;
        document.getElementById("comissao-total").innerText = comissao.toFixed(2);
        document.getElementById("comissao-total2").innerText = comissao.toFixed(2);
        document.getElementById("saldo").innerText = saldo.toFixed(2);
      } else {
        alert("Erro: " + data.erro);
      }
    })
    .catch(err => {
      console.error(err);
      alert("Erro ao processar saque da comiss√£o.");
    });
}
      
      // Captura ?ref= do link
let referencia = null;
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.has('ref')) {
  referencia = urlParams.get('ref');
      }
    netlifyIdentity.on('login', user=>{
  document.querySelector('.container').style.display='none';
  document.getElementById('mainDashboard').style.display='block';

  const nome = user.user_metadata && user.user_metadata.full_name 
                ? user.user_metadata.full_name 
                : user.email.split('@')[0];
  document.getElementById('userNome').innerText = "Bem-vindo, " + nome;
// Salva refer√™ncia de convite, se existir
  if (referencia) {
    fetch('/.netlify/functions/salvarReferencia', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        convidado: user.email,
        convidou: referencia
      })
    }).catch(err => console.error("Erro ao salvar refer√™ncia:", err));
      }
      // Registrar usu√°rio no banco
fetch('/.netlify/functions/registrarUsuario', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ email: user.email })
});
      // Buscar comiss√£o real do banco Neon
fetch(`/.netlify/functions/getComissao?email=${user.email}`)
  .then(res => res.json())
  .then(data => {
    if (data.comissao !== undefined) {
      comissao = parseFloat(data.comissao);
      document.getElementById("comissao-total").innerText = comissao.toFixed(2);
      document.getElementById("comissao-total2").innerText = comissao.toFixed(2);
    }
  })
  .catch(err => console.error("Erro ao buscar comiss√£o:", err));
  // Buscar saldo real do banco Neon
  fetch(`/.netlify/functions/getSaldo?email=${user.email}`)
    .then(res => res.json())
    .then(data => {
        if (data.saldo !== undefined) {
          saldo = parseFloat(data.saldo);
          atualizarSaldo();
        } else {
          alert("N√£o foi poss√≠vel buscar o saldo.");
        }
    })
    .catch(err => {
        console.error(err);
        alert("Erro ao buscar saldo.");
    });
});
    netlifyIdentity.on('logout',()=>{
      document.querySelector('.container').style.display='flex';
      document.getElementById('mainDashboard').style.display='none';
    });
    document.addEventListener("DOMContentLoaded",()=>{netlifyIdentity.init();});
  </script>
  <script>// Atualiza endere√ßo conforme rede selecionada
function atualizarEndereco() {
  const rede = document.getElementById("redeDeposito").value;
  const campoEndereco = document.getElementById("enderecoDeposito");

  if (rede === "BEP20") {
    campoEndereco.value = "0xa339998856200ccdf08599c074c9d4cac0453967";
  } else if (rede === "TRC20") {
    campoEndereco.value = "TLr9iaud155quXYbMbEv1kdij9Wdmyg4Vv";
  } else if (rede === "APTOS") {
    campoEndereco.value = "0xe24290096705d1657b367fe505494816264a75f343703746201d733f8328d5eb";
  }
}
  </script>
     
<script> // Fun√ß√£o para envio do dep√≥sito
async function solicitarDeposito() {
  const valor = parseFloat(document.getElementById("valorDeposito").value);
  const rede = document.getElementById("redeDeposito").value;
  const file = document.getElementById("comprovativo").files[0];

  if (!valor || !rede || !file) {
    alert("Preencha todos os campos e selecione um comprovativo.");
    return;
  }

  if (valor < 5) {
    alert("Dep√≥sito m√≠nimo √© 5 USDT");
    return;
  }

  // Converter o arquivo em Base64
  const toBase64 = file => new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
  });

  const comprovativoBase64 = await toBase64(file);

  const user = netlifyIdentity.currentUser();
  const email = user?.email;

  try {
    const res = await fetch('/.netlify/functions/novoDeposito', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email,
        valor,
        rede,
        comprovativo: comprovativoBase64
      })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "Erro ao enviar dep√≥sito");

    alert("Dep√≥sito enviado com sucesso! Aguarde aprova√ß√£o.");
    fecharDeposito();
    // Salva transa√ß√£o de dep√≥sito no hist√≥rico
fetch('/.netlify/functions/salvarTransacao', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email,
    tipo: "Dep√≥sito",
    valor,
    data: new Date().toISOString()
  })
});
  } catch (err) {
    console.error(err);
    alert("Erro: " + err.message);
  }
}
</script>
</body>
</html>
